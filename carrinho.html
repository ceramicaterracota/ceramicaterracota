<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Carrinho | Cer√¢mica Terracota</title>
<style>

    :root { --cor-principal: #a0522d; }
    body { font-family: Arial, sans-serif; background: #f5f5dc; padding: 10px; }
    
    .container {
        max-width: 900px; margin: 10px auto; background: #fffaf0;
        padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        box-sizing: border-box;
    }

    .item {
        display: flex; justify-content: space-between; gap: 15px;
        border-bottom: 1px solid #ddd; padding: 15px 0; align-items: center;
    }

    .item-info { flex-grow: 1; }

    button.btn-remover {
        background: #d9534f; color: white; border: none;
        padding: 5px 10px; border-radius: 4px; cursor: pointer;
    }

    .total { font-size: 1.4em; font-weight: bold; margin-top: 20px; text-align: right; }
    
    .btn-voltar {
        display: inline-block; margin-bottom: 18px; padding: 10px 16px;
        border-radius: 8px; text-decoration: none; background-color: var(--cor-principal); color: #fff;
    }

    .btn-finalizar {
        display: block; width: 100%; background: #25d366; color: white;
        border: none; padding: 15px; font-size: 1.1em; font-weight: bold;
        border-radius: 8px; cursor: pointer; margin-top: 20px;
    }

    /* --- ESTILO DOS BOT√ïES (DESKTOP E GERAL) --- */
    .controle-qtd {
        display: flex; align-items: center; background: #fff;
        border: 1px solid #ccc; border-radius: 4px; overflow: hidden;
        height: 30px; width: 80px; flex-shrink: 0;
    }

    .btn-qtd {
        background: #fdfdfd; color: #333; border: none;
        width: 25px; flex: 0 0 25px; height: 100%; cursor: pointer;
        display: flex; justify-content: center; align-items: center;
    }

    .qtd-numero {
        flex: 1; text-align: center; border-left: 1px solid #eee;
        border-right: 1px solid #eee; height: 100%; display: flex;
        align-items: center; justify-content: center;
    }

    /* --- AJUSTE EXCLUSIVO PARA CELULAR --- */
    @media screen and (max-width: 600px) {
        .item { flex-wrap: wrap; padding: 20px 0; }
        .item-info { width: 100%; margin-bottom: 10px; }

        .controle-qtd {
            background: transparent !important; border: none !important;
            width: 100px !important; position: relative !important;
            justify-content: space-between !important;
        }

        .btn-qtd {
            background: transparent !important; color: var(--cor-principal) !important;
            width: 30px !important; flex: 0 0 30px !important; font-size: 24px !important;
            font-weight: bold !important; z-index: 2;
        }

        .qtd-numero {
            background: #fff !important; border: 1px solid #ccc !important;
            border-radius: 4px !important; width: 35px !important; height: 30px !important;
            /* Centraliza√ß√£o absoluta: isso ignora o tamanho dos bot√µes ao lado */
            position: absolute !important; left: 50% !important; top: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 1; border-left: 1px solid #ccc !important; border-right: 1px solid #ccc !important;
        }

        .item span { flex-grow: 1; text-align: right; margin-right: 10px; font-weight: bold; }
    }
</style>

</head>

<body>
<div class="container">
    <a href="index.html" class="btn-voltar">‚Üê Voltar √† loja</a>

    <h1>Seu carrinho üõí</h1>

        <div id="calculadora-frete">
    <label for="cep">Calcular Frete (CEP):</label>
    <input type="text" id="cep" placeholder="00000-000">
    <button onclick="calcularFrete()">Calcular</button>
    <p id="resultado-frete">Frete: R$ 0,00</p>
</div>

    <div id="lista">
        </div>

    <p class="total" id="total">Total: R$ 0,00</p>

    <button class="btn-finalizar" onclick="enviarWhats()">Finalizar pedido no WhatsApp</button>
</div>

<script>
// Puxa os dados que o index.html salvou
let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
let valorFreteGlobal = 0;

function renderizar() {
    const lista = document.getElementById("lista");
    const totalElemento = document.getElementById("total");
    
    if (carrinho.length === 0) {
        lista.innerHTML = "<p>Seu carrinho est√° vazio.</p>";
        totalElemento.innerText = "Total: R$ 0,00";
        return;
    }

    lista.innerHTML = "";
    let soma = 0;

    carrinho.forEach((item, i) => {
        const subtotal = item.preco * item.quantidade;
        soma += subtotal;

        lista.innerHTML += `
            <div class="item">
                <div class="item-info">
                    <strong>${item.nome}</strong><br>
                    <small>Op√ß√£o: ${item.opcao || 'Padr√£o'}</small>
                </div>
                
                <div class="controle-qtd">
                    <button class="btn-qtd" onclick="alterarQtd(${i}, ${item.quantidade - 1})">‚àí</button>
                    <span class="qtd-numero">${item.quantidade}</span>
                    <button class="btn-qtd" onclick="alterarQtd(${i}, ${item.quantidade + 1})">+</button>
                </div>

                <span>R$ ${subtotal.toFixed(2)}</span>
                <button class="btn-remover" onclick="remover(${i})">X</button>
            </div>
        `;
    });

   // ... final do loop forEach
    const totalComFrete = soma + valorFreteGlobal; // <--- SOMA OS DOIS
    totalElemento.innerText = "Total: R$ " + totalComFrete.toFixed(2);
}

function alterarQtd(i, valor) {
    let item = carrinho[i];
    let nomeMinusculo = item.nome.toLowerCase();

    // 1. REGRA DE EXCE√á√ÉO: Se for o Kit 17, ele pula o bloqueio e vai direto para a atualiza√ß√£o
    const ehExcecao = nomeMinusculo.includes("kit 17");

    // 2. REGRA DE BLOQUEIO: Se for maior que 1 E for Kit/√önica E N√ÉO for exce√ß√£o
    if (valor > 1 && !ehExcecao && (nomeMinusculo.includes("kit"))) {
        alert(`Aten√ß√£o: "${item.nome}" √© uma pe√ßa √∫nica e exclusiva. N√£o temos mais unidades em estoque!`);
        return; 
    }

    // L√≥gica para remover (que voc√™ j√° tem)
    if (valor < 1) {
        if (confirm(`Deseja remover "${item.nome}" do carrinho?`)) remover(i);
        return;
    }
    
    // Atualiza√ß√£o normal (para o Kit 17 ou itens comuns)
    carrinho[i].quantidade = valor;
    salvarEAtualizar();
}

function remover(i) {
    carrinho.splice(i, 1);
    salvarEAtualizar();
}

function salvarEAtualizar() {
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    renderizar();
}

function enviarWhats() {
    if (carrinho.length === 0) {
        alert("Seu carrinho est√° vazio!");
        return;
    }

    // Come√ßamos com duas quebras de linha ap√≥s a sauda√ß√£o
    let texto = "Ol√°! Gostaria de fazer um pedido na Cer√¢mica Terracota:%0A%0A";
    let totalGeral = 0;

    carrinho.forEach(item => {
        const subtotal = item.preco * item.quantidade;
        totalGeral += subtotal;
        
        // %0A ao final de cada linha for√ßa o WhatsApp a pular para a pr√≥xima
        texto += `*${item.quantidade}x* ${item.nome}%0A`;
        texto += `(${item.opcao}) - R$ ${subtotal.toFixed(2)}%0A%0A`; 
    });

    // %0A antes do total para dar destaque
    texto += `*Total do Pedido: R$ ${totalGeral.toFixed(2)}*`;

    // Abre o WhatsApp com o texto corrigido
    window.open("https://wa.me/5518998034500?text=" + texto);
}

// Inicia a p√°gina
renderizar();
</script>

<script>
    async function calcularFrete() {
    const cep = document.getElementById('cep').value.replace(/\D/g, ''); // Pega s√≥ os n√∫meros
    const resultadoTexto = document.getElementById('resultado-frete');
    
    if (cep.length !== 8) {
        alert("CEP inv√°lido! Digite os 8 n√∫meros.");
        return;
    }

    try {
        // Consultando o CEP gratuitamente
        const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
        const dados = await response.json();

        if (dados.erro) {
            alert("CEP n√£o encontrado.");
            return;
        }

        // Regra de neg√≥cio (Exemplo: SP √© 15 reais, outros estados 30)
     // ... dentro da calcularFrete
    valorFreteGlobal = 30.00; // <--- Agora ela salva na gaveta global
    if (dados.uf === 'SP') {
    valorFreteGlobal = 15.00;
}

        // Exibe o valor do frete
       resultadoTexto.innerText = `Frete para ${dados.localidade}: R$ ${valorFreteGlobal.toFixed(2)}`;
        
        // Chama a fun√ß√£o para somar tudo
        renderizar(); // <--- ISSO FAZ O TOTAL L√Å DE CIMA ATUALIZAR NA HORA!

    } catch (error) {
        console.error("Erro ao buscar CEP", error);
    }
}
</script>

</body>
</html>