<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Carrinho | Cer√¢mica Terracota</title>
<style>

    :root { --cor-principal: #a0522d; }
    body { font-family: Arial, sans-serif; background: #f5f5dc; padding: 10px; }
    
    .container {
        max-width: 900px; margin: 10px auto; background: #fffaf0;
        padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        box-sizing: border-box;
    }

    .item {
        display: flex; justify-content: space-between; gap: 15px;
        border-bottom: 1px solid #ddd; padding: 15px 0; align-items: center;
    }

    .item-info { flex-grow: 1; }

    button.btn-remover {
        background: #d9534f; color: white; border: none;
        padding: 5px 10px; border-radius: 4px; cursor: pointer;
    }

    .total { font-size: 1.4em; font-weight: bold; margin-top: 20px; text-align: right; }
    
    .btn-voltar {
        display: inline-block; margin-bottom: 18px; padding: 10px 16px;
        border-radius: 8px; text-decoration: none; background-color: var(--cor-principal); color: #fff;
    }

    .btn-finalizar {
        display: block; width: 100%; background: #25d366; color: white;
        border: none; padding: 15px; font-size: 1.1em; font-weight: bold;
        border-radius: 8px; cursor: pointer; margin-top: 20px;
    }

    /* --- ESTILO DOS BOT√ïES (DESKTOP E GERAL) --- */
    .controle-qtd {
        display: flex; align-items: center; background: #fff;
        border: 1px solid #ccc; border-radius: 4px; overflow: hidden;
        height: 30px; width: 80px; flex-shrink: 0;
    }

    .btn-qtd {
        background: #fdfdfd; color: #333; border: none;
        width: 25px; flex: 0 0 25px; height: 100%; cursor: pointer;
        display: flex; justify-content: center; align-items: center;
    }

    .qtd-numero {
        flex: 1; text-align: center; border-left: 1px solid #eee;
        border-right: 1px solid #eee; height: 100%; display: flex;
        align-items: center; justify-content: center;
    }

    /* --- AJUSTE EXCLUSIVO PARA CELULAR --- */
    @media screen and (max-width: 600px) {
        .item { flex-wrap: wrap; padding: 20px 0; }
        .item-info { width: 100%; margin-bottom: 10px; }

        .controle-qtd {
            background: transparent !important; border: none !important;
            width: 100px !important; position: relative !important;
            justify-content: space-between !important;
        }

        .btn-qtd {
            background: transparent !important; color: var(--cor-principal) !important;
            width: 30px !important; flex: 0 0 30px !important; font-size: 24px !important;
            font-weight: bold !important; z-index: 2;
        }

        .qtd-numero {
            background: #fff !important; border: 1px solid #ccc !important;
            border-radius: 4px !important; width: 35px !important; height: 30px !important;
            /* Centraliza√ß√£o absoluta: isso ignora o tamanho dos bot√µes ao lado */
            position: absolute !important; left: 50% !important; top: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 1; border-left: 1px solid #ccc !important; border-right: 1px solid #ccc !important;
        }

        .item span { flex-grow: 1; text-align: right; margin-right: 10px; font-weight: bold; }
    
        #calculadora-frete {
        padding: 15px;
    }
    
        #calculadora-frete input, 
        #calculadora-frete button {
        width: 100%; /* Garante que ocupem toda a largura no celular */
        box-sizing: border-box;
    }
    }

    /* --- ESTILO DA CALCULADORA DE FRETE --- */
#calculadora-frete {
    background: #fff;
    padding: 13px 16px;
    border-radius: 12px;
    border: 1px solid #ddd;
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: fit-content; /* O fundo colorido s√≥ vai at√© onde termina o texto */
    text-align: left;    /* Alinha o texto √† esquerda dentro dele */
}

#calculadora-frete label {
    font-weight: bold;
    color: var(--cor-principal);
    font-size: 1em;
}

#calculadora-frete input {
    padding: 6px; /* Aumentado para facilitar o toque no celular */
    border: 2px solid #eee;
    border-radius: 8px;
    font-size: 0.95em;
    outline: none;
    transition: border-color 0.3s;
}

#calculadora-frete input:focus {
    border-color: var(--cor-principal);
}

#calculadora-frete button {
    background-color: var(--cor-principal);
    color: white;
    border: none;
    padding: 8px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 0.95em;
    cursor: pointer;
    transition: opacity 0.2s;
    width: 100px; /* O bot√£o s√≥ ter√° o tamanho do texto interno */
    align-self: flex-start; /* Garante que ele fique alinhado √† esquerda e n√£o estique */
}

#calculadora-frete button:hover {
    opacity: 0.9;
}

#resultado-frete {
    margin: 0;
    font-weight: bold;
    color: #444;
    background: #fdf2e9;
    padding: 6px;
    border-radius: 6px;
    text-align: center;
    width: fit-content; /* O fundo colorido s√≥ vai at√© onde termina o texto */
    text-align: left;    /* Alinha o texto √† esquerda dentro dele */
}

</style>

</head>

<body>
<div class="container">
    <a href="index.html" class="btn-voltar">‚Üê Voltar √† loja</a>

    <h1>Seu carrinho üõí</h1>

        <div id="calculadora-frete">
    <label for="cep">Calcular Frete (CEP):</label>
    <input type="text" id="cep" placeholder="00000-000">
    <button onclick="calcularFrete()">Calcular</button>
    <p id="resultado-frete">Frete: R$ 0,00</p>
</div>

    <div id="lista">
        </div>

    <p class="total" id="total">Total: R$ 0,00</p>

    <button class="btn-finalizar" onclick="enviarWhats()">Finalizar pedido no WhatsApp</button>
</div>

<script> 
// 1. Vari√°veis de controle
let carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
let valorFreteGlobal = 0; 
let cidadeUFCliente = ""; 

// 2. Fun√ß√£o para mostrar os produtos na tela
function renderizar() {
    const lista = document.getElementById("lista");
    const totalElemento = document.getElementById("total");
    
    if (carrinho.length === 0) {
        lista.innerHTML = "<p>Seu carrinho est√° vazio.</p>";
        totalElemento.innerText = "Total: R$ 0,00";
        return;
    }

    lista.innerHTML = "";
    let somaProdutos = 0;

    carrinho.forEach((item, i) => {
        const subtotal = item.preco * item.quantidade;
        somaProdutos += subtotal;
        lista.innerHTML += `
            <div class="item">
                <div class="item-info"><strong>${item.nome}</strong><br><small>${item.opcao || 'Padr√£o'}</small></div>
                <div class="controle-qtd">
                    <button class="btn-qtd" onclick="alterarQtd(${i}, ${item.quantidade - 1})">‚àí</button>
                    <span class="qtd-numero">${item.quantidade}</span>
                    <button class="btn-qtd" onclick="alterarQtd(${i}, ${item.quantidade + 1})">+</button>
                </div>
                <span>R$ ${subtotal.toFixed(2)}</span>
                <button class="btn-remover" onclick="remover(${i})">X</button>
            </div>`;
    });

    const totalFinal = somaProdutos + valorFreteGlobal;
    totalElemento.innerText = "Total: R$ " + totalFinal.toFixed(2);
}

// 3. Fun√ß√£o de Calcular Frete (Indiana/SP e PR)
async function calcularFrete() {
    const cepInput = document.getElementById('cep').value.replace(/\D/g, '');
    const resultadoTexto = document.getElementById('resultado-frete');

    if (cepInput.length !== 8) { 
        alert("Digite um CEP v√°lido com 8 n√∫meros."); 
        return; 
    }

    try {
        const response = await fetch(`https://viacep.com.br/ws/${cepInput}/json/`);
        const dados = await response.json();
        
        if (dados.erro) { 
            alert("CEP n√£o encontrado."); 
            return; 
        }

        // SALVANDO A CIDADE AQUI
        cidadeUFCliente = dados.localidade + " - " + dados.uf;

        let qtdItens = 0;
        carrinho.forEach(item => qtdItens += item.quantidade);
        
        if (dados.uf === 'SP' || dados.uf === 'PR') {
            valorFreteGlobal = 18.00 + (qtdItens * 2); 
        } else if (['RJ', 'MG', 'MS', 'SC', 'RS'].includes(dados.uf)) {
            valorFreteGlobal = 35.00 + (qtdItens * 4); 
        } else {
            valorFreteGlobal = 55.00 + (qtdItens * 5); 
        }

        resultadoTexto.innerText = "Frete para " + cidadeUFCliente + ": R$ " + valorFreteGlobal.toFixed(2);
        renderizar(); 
        
    } catch (e) { 
        alert("Erro ao buscar o frete."); 
    }
}

// 4. Regra dos KITS √öNICOS
function alterarQtd(i, valor) {
    let item = carrinho[i];
    let nomeMinusculo = item.nome.toLowerCase();
    const ehExcecao = nomeMinusculo.includes("kit 17");

    if (valor > 1 && !ehExcecao && (nomeMinusculo.includes("kit"))) {
        alert("Atencao: " + item.nome + " e uma peca unica!");
        return; 
    }

    if (valor < 1) {
        if (confirm("Deseja remover " + item.nome + "?")) remover(i);
        return;
    }
    
    carrinho[i].quantidade = valor;
    salvarEAtualizar();
}

// 5. Enviar para WhatsApp (Sem emojis para evitar erro de "?")
 function enviarWhats() {
    if (valorFreteGlobal === 0) {
        alert("‚ö†Ô∏è Por favor, calcule o frete antes de finalizar!");
        return;
    }

    if (carrinho.length === 0) {
        alert("Carrinho vazio!");
        return;
    }

    let texto = "Ol√°! Gostaria de fazer um pedido na Cer√¢mica Terracota:%0A%0A";
    let somaProd = 0;
    
    carrinho.forEach(item => {
        const subtotalItem = item.preco * item.quantidade;
        somaProd += subtotalItem;
        
        // Monta a linha do nome e quantidade
        texto += `*${item.quantidade}x* ${item.nome}%0A`;
        
        // Adiciona a opcao (tamanho/cor) e o preco se existirem
        if (item.opcao) {
            texto += `(${item.opcao}) - R$ ${item.preco.toFixed(2)}%0A`;
        } else {
            texto += `R$ ${item.preco.toFixed(2)}%0A`;
        }
        texto += "%0A"; // Pula uma linha entre produtos
    });

    texto += `%0A*CIDADE:* ${cidadeUFCliente}`;
    texto += `%0A*FRETE:* R$ ${valorFreteGlobal.toFixed(2)}`;
    texto += `%0A*TOTAL DO PEDIDO: R$ ${(somaProd + valorFreteGlobal).toFixed(2)}*`;

    window.open("https://wa.me/5518998034500?text=" + texto);
}

function remover(i) {
    carrinho.splice(i, 1);
    salvarEAtualizar();
}

function salvarEAtualizar() {
    localStorage.setItem("carrinho", JSON.stringify(carrinho));
    renderizar();
}

renderizar();
</script>

</body>
</html>